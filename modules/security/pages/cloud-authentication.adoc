= Authentication
:description: Learn about Redpanda Cloud authentication.
:page-toclevels: 3
:page-aliases: manage:security/authentication.adoc

Redpanda Cloud uses authentication to verify who can access your clusters and perform actions. 

* *User authentication*: How people access the Redpanda Cloud UI and manage resources
* *Service authentication*: How applications and services connect to your Redpanda clusters

== User authentication

Redpanda provides user authentication to your Redpanda organization through email/password or single sign-on (SSO) with OIDC-based identity provider (IdP). 

=== Email/password

Passwords are hashed (a one-way function that makes the original value unrecoverable, and effectively encrypted) and salted at rest using https://en.wikipedia.org/wiki/Bcrypt[bcrypt^].

=== Single sign-on

Redpanda integrates with any OIDC-compliant IdP that supports discovery, including <<integrate-with-okta,Okta>>, <<integrate-with-microsoft-entra-id,Microsoft Entra ID>>, Auth0, Active Directory Federation Services (AD-FS), and JumpCloud. After SSO is enabled for an organization, new users in that organization can authenticate with SSO. 

You must integrate your IdP with Redpanda Cloud to use SSO. On the *Users* page, users with the admin permissions see a *Single sign-on* tab and can add connections for up to two different IdPs. Enter the client ID, client secret, and discovery URI for the IdP. (See your IdP documentation for these values. The discovery URI may be called something different, like the well known URL or the `issuer_url`.) 

By default, the connection is added in a disabled state. Edit the connection to enable it. You can choose to enable auto-enroll in the connection, which provides new users signing in from that IdP access to your Redpanda organization. When you enable auto-enroll, you select to assign a Reader, Writer, or Admin role to users who log in with that IdP. Set up is different across IdPs. 

NOTE: Before you can delete an SSO connection, an admin must manually delete all users associated with that connection.

==== Integrate with Okta

To integrate with Okta, follow the https://help.okta.com/en-us/Content/Topics/Apps/Apps_App_Integration_Wizard_OIDC.htm[Okta documentation^] to create an application within Okta for Redpanda. The Redpanda callback location (that is, the redirect location where Okta sends the user) is the following:


```
https://auth.prd.cloud.redpanda.com/login/callback
```

Okta provides the following fields required for SSO configuration on the Redpanda *Users* page: `clientId`, `clientSecret`, and `discoveryUrl`. The discovery URL for Okta generally looks like the following (where `an_id` could be “default”):

[pass]
```
https://<orgname>.okta.com/oauth2/<an_id>/.well-known/openid-configuration
``` 

==== Integrate with Microsoft Entra ID

To integrate with Microsoft Entra ID, create a Web application registration that uses the OIDC Authorization Code flow with PKCE:

. In the https://entra.microsoft.com/[Microsoft Entra admin center^], go to *App registrations* and click *New registration*.
.. Name: `Redpanda Cloud`.
.. Supported account types: *Accounts in this organizational directory only (Single tenant)*.
.. Redirect URI: select *Web*, and paste the Callback URL from Redpanda Cloud. To find the Callback URL, go to *Users* > *Single sign-on* in Redpanda Cloud and click *Add connection*. Copy the *Callback URL*.
+
IMPORTANT: The platform type must be *Web*. Because Redpanda Cloud uses the OIDC Authorization Code flow with PKCE and a server-side callback, the app must be configured as Web (not SPA or mobile).
.. Click *Register*.
. After registration, a corresponding Enterprise application (service principal) appears under *Enterprise applications*. If your organization restricts access, assign users/groups to this Enterprise application to allow access to Redpanda Cloud.
. On the application registration for Redpanda Cloud, click *Endpoints* and copy the *OpenID Connect metadata document* URL.
. In Redpanda Cloud, on the *Users*: *Single sign-on* page, paste that endpoint address into the *Discovery URI* field. Then, complete the SSO configuration:
.. For *Client ID*, copy and paste the *Application (client) ID* from the Azure app for Redpanda Cloud.
.. For *Client secret*, copy and paste the secret you get from adding a client secret on the Certificates & secrets page for the Azure app for Redpanda Cloud.
.. For *Realm*, enter your Microsoft Entra ID tenant domain name.
.. Click *Save*.
.. On the Redpanda Cloud Users: Single sign-on page, edit your new Entra ID connection to enable single sign-on. 
+
Users with an email address with that realm (domain) can now access your Redpanda Cloud account. 
+
[NOTE]
====

* No additional claims required: Redpanda Cloud only relies on standard OIDC claims provided by your IdP. You do not need to configure optional claims or group claims in ID/Access tokens.
* No API permissions required: You do not need Microsoft Graph or any other API permissions. Microsoft Graph `User.Read` may be listed (some tenants add it during app creation), but Redpanda Cloud performs OIDC sign-in only and does not call Microsoft Graph.
* First-login consent only: On first sign-in, users are prompted to consent to the standard OIDC scopes `openid`, `profile`, and `email`. After the first consent, users should not be prompted again unless consent is revoked or the app configuration changes.
====

===== Tips for Integrating Entra ID

If users are repeatedly prompted for consent or cannot log in:

* Ensure the app is configured as Web with the exact Redirect URI from Redpanda Cloud.
* Remove any extra API permissions (for example, `Microsoft Graph: User.Read`).
* Avoid adding non-standard claims or scopes.

=== Multi-factor authentication (MFA)

Improve account security by requiring a second verification step when logging in to Redpanda Cloud. Redpanda Cloud supports time-based one-time passwords (TOTP) using an authenticator app (for example, Google Authenticator, Microsoft Authenticator, 1Password). You can enable MFA for your own account, and organization administrators can enable MFA for all members of the organization.

During the initial MFA setup, after entering your login credentials, you're prompted to scan a QR code to get a TOTP code from an authenticator app. Enter that 6-digit code to access Redpanda Cloud. Subsequent logins also require entering a TOTP code, but you can choose to remember the device to skip the MFA prompt on that device for the next 30 days.

As part of the initial setup, you're also prompted to save a separate recovery code. Keep the recovery code offline and secure. You can use that recovery code to regain access to Redpanda Cloud, if necessary (for example, if your phone is lost). 

==== Enable MFA (individual users)

Users can enable MFA for their own accounts.

. In the Cloud UI, select your profile avatar and choose *Manage user*.
. Open the *Security* tab.
. Click *Enable* to set up multi-factor authentication.

==== Enforce MFA (organization admins)

Administrators can require MFA for all users in an organization.

. In the Cloud UI, go to *Organization IAM*.
. Open the *MFA* tab.
. Click *Enable* to require MFA for all members of this organization.

==== Troubleshooting

* *New phone or lost access:* If you can't access your authenticator app, select to try another access method and enter your recovery code. 
* *TOTP code not accepted:* Ensure the code hasn't expired and that your phone's time is set automatically; time drift can cause invalid codes.
* *Remembered device prompts again:* The 30-day trust is device- and browser-specific. Clearing cookies, switching browsers, or using a new device requires re-verification.

=== User impersonation badge::[label=beta, tooltip={page-beta-text}]

include::shared:partial$feature-flag.adoc[]

BYOC and Dedicated clusters support unified authentication and authorization between the Redpanda Cloud UI and Redpanda with user impersonation. This means you can use the same credentials to authenticate to both Redpanda Cloud and the underlying Redpanda cluster, with consistent permissions across all interfaces. This ensures accurate audit logs and unified identity enforcement across all client applications, including the Cloud UI. With user impersonation enabled, the topics and resources users see in the UI match exactly what they can access with the Cloud API or `rpk`. 

* *Without user impersonation*: Redpanda Cloud uses a static service account to access your cluster. All UI requests appear to come from this generic admin user.
* *With user impersonation*: Redpanda Cloud uses your individual user credentials and evaluates permissions using glossterm:ACL[,access control lists (ACLs)] and glossterm:RBAC[,role-based access control (RBAC)] in the data plane. Each user sees only the resources they have permission to access.  

To enable user impersonation:

. Go to the *Cluster settings* page and select the option to enable user impersonation.
. Configure permissions for your users on the cluster *Security* page using ACLs or RBAC roles.

[IMPORTANT]
====
After enabling user impersonation:

* *Admin users* continue to have full access as before
* *Reader and Writer users* will lose access to the cluster until you explicitly grant them permissions through ACLs or RBAC roles on the *Security* page

Plan to configure user permissions before or immediately after enabling this feature to avoid access disruption.
==== 

== Service authentication

Your applications and tools need to authenticate when connecting to Redpanda APIs. Redpanda Cloud supports different authentication methods depending on which API you're using and your cloud provider. 

* *SASL* (Simple Authentication and Security Layer): Username and password authentication over encrypted connections
* *mTLS* (Mutual TLS): Certificate-based authentication where both client and server verify each other's identity  
* *Basic authentication*: Username and password sent in HTTP headers over encrypted connections

NOTE: mTLS authentication is supported on AWS and GCP clusters only. Azure clusters currently support SASL and basic authentication only. 

=== Authentication methods by API

Different APIs support different authentication methods:

* *Kafka API*: Redpanda Cloud supports both SASL (over TLS 1.2) and <<mtls,mTLS>> authentication for Kafka clients connecting to Redpanda clusters over the TCP endpoint or listener.
* *HTTP Proxy API* and *Schema Registry API*: Redpanda Cloud supports HTTP basic authentication (encrypted over TLS 1.2) and <<mtls,mTLS>> for client authentication.

For AWS and GCP, you can simultaneously enable mTLS and SASL for the Kafka API, and mTLS and basic authentication for the HTTP APIs (HTTP Proxy and Schema Registry). 

When you enable both authentication methods, Redpanda creates separate listeners:

* One mTLS listener on a specific port
* One SASL/basic authentication listener on a different port

This allows clients to choose which authentication method to use when connecting.

[%collapsible]
|===
|Cloud provider |API |Supported authentication methods

.3+a|AWS

See <<enable-mtls-and-sasl,Enable mTLS and SASL>>

|Kafka API
a|
* SASL
** SASL/SCRAM
** SASL/PLAIN
* mTLS

|HTTP Proxy API
a|
* Basic authentication
* mTLS

|Schema Registry API
a|
* Basic authentication
* mTLS

.3+a|GCP

See <<enable-mtls-and-sasl,Enable mTLS and SASL>> 

|Kafka API
a|
* SASL
** SASL/SCRAM
** SASL/PLAIN
* mTLS

|HTTP Proxy API
a|
* Basic authentication
* mTLS

|Schema Registry API
a|
* Basic authentication
* mTLS

.3+|Azure
|Kafka API
a|
* SASL
** SASL/SCRAM
** SASL/PLAIN

|HTTP Proxy API
a|
* Basic authentication

|Schema Registry API
a|
* Basic authentication
|===


NOTE: Each Redpanda Cloud glossterm:data plane[] runs its own dedicated agent,
which authenticates and connects against the control plane over a single TLS 1.2
encrypted TCP connection.

The following features use IAM policies to generate
dynamic and short-lived credentials to interact with cloud provider APIs:

* Data plane agent
* Tiered Storage
* Redpanda Console
* Kafka Connect

xref:security:authorization/cloud-iam-policies.adoc[IAM policies] have constrained permissions so that each service can only
access or manage its own data plane-scoped resources, following the principle of
least privilege.

=== Configure service authentication

When you create a new cluster using the https://cloud.redpanda.com/[Cloud UI^], the cluster is enabled by default with SASL for the Kafka API and basic authentication for the HTTP Proxy API and Schema Registry API.

=== Requirements

To configure service authentication using the Cloud API, you must have:

* A service account in your Redpanda organization with administrative privileges
* Access to the link:/api/doc/cloud-controlplane/topic/topic-cloud-api-overview[Cloud API]

==== Configuration methods by interface

* *Cloud UI*: Create clusters with default SASL/basic authentication, or enable mTLS for HTTP Proxy and Schema Registry on existing clusters
* *Cloud API*: Required to:
** Create mTLS-enabled clusters
** Enable mTLS for the Kafka API on existing clusters  
** Enable both mTLS and SASL/basic authentication simultaneously

=== Authenticate to the Cloud API

. Create a service account in your organization, if you haven't already. Go to the Service account tab of the https://cloud.redpanda.com/organization-iam?tab=service-accounts[Organization IAM^] page in the Redpanda Cloud UI and click *Create service account* to create a service account. Enter a name and description.
. Retrieve the client ID and secret by clicking *Copy ID* and *Copy Secret*. 
. Obtain an access token by making a `POST` request to `\https://auth.prd.cloud.redpanda.com/oauth/token` with the ID and secret in the request body. 
+
[,bash]
----
AUTH_TOKEN=`curl -s --request POST \
    --url 'https://auth.prd.cloud.redpanda.com/oauth/token' \
    --header 'content-type: application/x-www-form-urlencoded' \
    --data grant_type=client_credentials \
    --data client_id=<client-id> \
    --data client_secret=<client-secret> \
    --data audience=cloudv2-production.redpanda.cloud | jq -r .access_token`
----
+
Make sure to replace the following variables:
+
[cols="1,1"]
|===
|Placeholder variable |Description

|`<client-id>`
|Client ID.

|`<client-secret>`
|Client secret.
|===

[[mtls]]
=== Enable mTLS authentication
:description: Use the Cloud API to enable mTLS for Kafka API, HTTP Proxy, and Schema Registry connections on your Redpanda cluster.

For clusters with mTLS authentication, Redpanda creates a dedicated mTLS-enabled listener for each API service (Kafka API, HTTP Proxy, or Schema Registry) where you've enabled this authentication method. After you enable mTLS, <<retrieve-api-endpoints,get the API endpoints>> and <<verify-mtls,verify that mTLS authentication is in effect>>. 

[NOTE]
====

* mTLS authentication is supported on AWS and GCP clusters only.
* If you enable mTLS authentication, you cannot disable it later.
==== 


==== Create a new cluster with mTLS enabled

. Follow the steps to create a resource group and network for xref:manage:api/cloud-byoc-controlplane-api.adoc#create-a-resource-group[BYOC] or xref:manage:api/cloud-dedicated-controlplane-api.adoc#create-a-resource-group[Dedicated], if you haven't already. You'll need the resource group ID and network ID to create a cluster in the next step.

. Make a link:/api/doc/cloud-controlplane/operation/operation-clusterservice_createcluster[`POST /v1/clusters`] request to create a new cluster with mTLS enabled.

NOTE: The following example enables mTLS for the Kafka API. To enable mTLS for HTTP Proxy and Schema Registry, add the `http_proxy.mtls` and `schema_registry.mtls` fields to the request body. You can choose to enable mTLS for any combination of the three services.

.Show example request to enable mTLS for Kafka API
[%collapsible]
====
[,bash,lines=13-19,%collapsible]
----
CLUSTER_CREATE_BODY=`cat << EOF
{
  "cluster": {
    "cloud_provider": "<cloud-provider>",
    "connection_type": "CONNECTION_TYPE_PRIVATE",
    "name": "<cluster-name>",
    "resource_group_id": "<resource-group-id>",
    "network_id": "<network-id>",
    "region": "<region>",
    "zones": [ <zones> ],
    "throughput_tier": "<tier>",
    "type": "<cluster-type>",
    "kafka_api": {
       "mtls": {
          "enabled": true,
          "ca_certificates_pem": ["<ca-certificate-pem>"],
          "principal_mapping_rules": ["<principal-mapping-rule>"]
       }
    }
  }
}
EOF`
curl -v -X POST \
-H "Content-Type: application/json" \
-H "Authorization: Bearer $AUTH_TOKEN" \
-d "$CLUSTER_CREATE_BODY" https://api.redpanda.com/v1/clusters/<cluster-id>
----

Make sure to replace the following variables:

[cols="1,1"]
|===
|Placeholder variable |Description

|`<cluster-id>`
|ID of the Redpanda cluster.

|`<cloud-provider>`
|Cloud provider for the cluster (`CLOUD_PROVIDER_AWS` or `CLOUD_PROVIDER_GCP`).

|`<cluster-name>`
|Name of the Redpanda cluster.

|`<resource-group-id>`
|ID of the resource group.

|`<network-id>`
|ID of the network.

|`<region>`
|The region where the cluster is created. For example, `us-central1`.

|`<zones>`
|The zones where the cluster is created. For example, `["us-central1-a", "us-central1-b", "us-central1-c"]`.

|`<tier>`
|The xref:reference:tiers/index.adoc[usage tier of the cluster].

|`<cluster-type>`
|The Redpanda cluster type, `TYPE_BYOC` or `TYPE_DEDICATED`.

|`<ca-certificate-pem>`
|A trusted Kafka client CA certificate in PEM format. The `ca_certificates_pem` field accepts a list of certificates.

|`<principal-mapping-rule>`
a|Configurable rule for mapping the Distinguished Name of Kafka client certificates to Kafka principals.  

For example, the mapping rule `RULE:.\*CN=([^,]+).*/\\$1/` maps the following certificate subject to a principal named `test`:

`Subject: C=US, ST=IL, L=Chicago, O=redpanda, OU=cloud, CN=test, emailAddress=test123@redpanda.com`

See xref:ROOT:manage:security/authentication.adoc#mtls[Configure Authentication] for more details on principal mapping rules. The `principal_mapping_rules` field accepts a list of rules.
|===
====

The Create Cluster endpoint returns a long-running operation. You can check the status of the operation by making a `GET` request to the following endpoint:

[,bash]
----
curl -H "Authorization: Bearer $AUTH_TOKEN" https://api.redpanda.com/v1/operations/<operation-id>
----

When the operation state is `COMPLETED`, you can <<verify-mtls,verify that mTLS is enabled>> for the API endpoints.

==== Update an existing cluster to use mTLS

Make a link:/api/doc/cloud-controlplane/operation/operation-clusterservice_updatecluster[`PATCH /v1/clusters/{cluster.id}`] request to enable mTLS for the Kafka API on a cluster.

The following code block shows a request to enable mTLS for the Kafka API. To enable mTLS for HTTP Proxy and Schema Registry, add the `http_proxy.mtls` and `schema_registry.mtls` fields to the request body:

.Show example request
[%collapsible]
====
[,bash]
----
CLUSTER_PATCH_BODY=`cat << EOF
{
  "kafka_api": {
     "mtls": {
        "enabled": true,
        "ca_certificates_pem": ["<ca-certificate-pem>"],
        "principal_mapping_rules": ["<principal-mapping-rule>"]
     }
  }
}
EOF`
curl -v -X PATCH \
-H "Content-Type: application/json" \
-H "Authorization: Bearer $AUTH_TOKEN" \
-d "$CLUSTER_PATCH_BODY" https://api.redpanda.com/v1/clusters/<cluster-id>
----

Make sure to replace the following variables:

[cols="1,1"]
|===
|Placeholder variable |Description

|`<cluster-id>`
|ID of Redpanda cluster.

|`<ca-certificate-pem>`
|A trusted Kafka client CA certificate in PEM format. The `ca_certificates_pem` field accepts a list of certificates.

|`<principal-mapping-rule>`
a|Configurable rule for mapping the Distinguished Name of Kafka client certificates to Kafka principals.  

For example, the mapping rule `RULE:.\*CN=([^,]+).*/\\$1/` maps the following certificate subject to a principal named `test`:

`Subject: C=US, ST=IL, L=Chicago, O=redpanda, OU=cloud, CN=test, emailAddress=test123@redpanda.com`

See xref:ROOT:manage:security/authentication.adoc#mtls[Configure Authentication] for more details on principal mapping rules. The `principal_mapping_rules` field accepts a list of rules.
|===
====

The Update Cluster endpoint returns a long-running operation. You can check the status of the operation by making a `GET` request to the following endpoint:

[,bash]
----
curl -H "Authorization: Bearer $AUTH_TOKEN" https://api.redpanda.com/v1/operations/<operation-id>
----

When the operation state is `COMPLETED`, you can <<verify-mtls,verify that mTLS is enabled>> for the API endpoints.

=== Enable mTLS and SASL

NOTE: You can enable mTLS and SASL simultaneously for AWS and GCP clusters only. To unlock this feature for your account, contact your Customer Success Manager.

You can choose to enable mTLS and SASL simultaneously for the Kafka API, and mTLS and Basic authentication for HTTP Proxy and Schema Registry. The `sasl` field in the API request examples toggle both SASL and basic authentication. 

==== Create a new cluster with both mTLS and SASL enabled

. Follow the steps to create a resource group and network for link:/api/doc/cloud-controlplane/operation/operation-clusterservice_createcluster[BYOC] or link:/api/doc/cloud-controlplane/operation/operation-clusterservice_createcluster[Dedicated], if you haven't already done so. You'll need the resource group ID and network ID to create a cluster in the next step.

. Make a link:/api/doc/cloud-controlplane/operation/operation-clusterservice_createcluster[`POST /v1/clusters`] request to create a new cluster with both mTLS and SASL or basic authentication enabled.
+
You can enable mTLS and SASL or basic authentication for any combination of the three services. For example, if you want to enable mTLS and SASL simultaneously for Kafka API and mTLS and basic authentication simultaneously for Schema Registry only, leave out the entire `http_proxy` block from the request body. If you want to enable mTLS only for the Kafka API, and mTLS and basic authentication for HTTP Proxy and Schema Registry, leave out the `kafka_api.sasl` field.
+
.Show example request
[%collapsible]
====
[,bash,lines=13+23+32]
----
CLUSTER_CREATE_BODY=`cat << EOF
{
  "cluster": {
    "cloud_provider": "<cloud-provider>",
    "connection_type": "CONNECTION_TYPE_PRIVATE",
    "name": "<cluster-name>",
    "resource_group_id": "<resource-group-id>",
    "network_id": "<network-id>",
    "region": "<region>",
    "zones": [ <zones> ],
    "throughput_tier": "<tier>",
    "type": "<cluster-type>",
    "kafka_api": {
       "mtls": {
          "enabled": true,
          "ca_certificates_pem": ["<ca-certificate-pem>"],
          "principal_mapping_rules": ["<principal-mapping-rule>"]
       },
       "sasl": {
          "enabled": true
       }
    },
    "http_proxy": {
       "mtls": {
          "enabled": true,
          "ca_certificates_pem": ["<ca-certificate-pem>"]
       },
       "sasl": {
          "enabled": true
       }
    },
    "schema_registry": {
       "mtls": {
          "enabled": true,
          "ca_certificates_pem": ["<ca-certificate-pem>"]
       },
       "sasl": {
          "enabled": true
       }
    }
  }
}
EOF`
curl -v -X POST \
-H "Content-Type: application/json" \
-H "Authorization: Bearer $AUTH_TOKEN" \
-d "$CLUSTER_CREATE_BODY" https://api.redpanda.com/v1/clusters/<cluster-id>`
----

Make sure to replace the following variables:

[cols="1,1"]
|===
|Placeholder variable |Description

|`<cluster-id>`
|ID of Redpanda cluster.

|`<cloud-provider>`
|Cloud provider for the cluster (`CLOUD_PROVIDER_AWS` or `CLOUD_PROVIDER_GCP`).

|`<cluster-name>`
|Name of the Redpanda cluster.

|`<resource-group-id>`
|ID of the resource group.

|`<network-id>`
|ID of the network.

|`<region>`
|The region where the cluster is created. For example, `us-central1`.

|`<zones>`
|The zones where the cluster is created. For example, `["us-central1-a", "us-central1-b", "us-central1-c"]`.

|`<tier>`
|The xref:reference:tiers/index.adoc[usage tier of the cluster].

|`<cluster-type>`
|The Redpanda cluster type, `TYPE_BYOC` or `TYPE_DEDICATED`.

|`<ca-certificate-pem>`
|A trusted Kafka client CA certificate in PEM format. The `ca_certificates_pem` field accepts a list of certificates.

|`<principal-mapping-rule>`
a|Configurable rule for mapping the Distinguished Name of Kafka client certificates to Kafka principals.  

For example, the mapping rule `RULE:.\*CN=([^,]+).*/\\$1/` maps the following certificate subject to a principal named `test`:

`Subject: C=US, ST=IL, L=Chicago, O=redpanda, OU=cloud, CN=test, emailAddress=test123@redpanda.com`

See xref:ROOT:manage:security/authentication.adoc#mtls[Configure Authentication] for more details on principal mapping rules. The `principal_mapping_rules` field accepts a list of rules.
|===
====

The Create Cluster endpoint returns a long-running operation. You can check the status of the operation by making a `GET` request to the following endpoint:

[,bash]
----
curl -H "Authorization: Bearer $AUTH_TOKEN" https://api.redpanda.com/v1/operations/<operation-id>
----

When the operation state is `COMPLETED`, you can <<verify-mtls,verify that mTLS is enabled>> for the API endpoints.

==== Update an existing cluster to use mTLS and SASL

Make a link:/api/doc/cloud-controlplane/operation/operation-clusterservice_updatecluster[`PATCH /v1/clusters/{cluster.id}`] request to enable mTLS and SASL on an existing cluster.

You can choose to enable mTLS and SASL or basic authentication for any combination of the three services. For example, if you want to enable mTLS and SASL simultaneously for Kafka API and mTLS and basic authentication simultaneously for Schema Registry only, leave out the entire `http_proxy` block from the request body. If you want to enable mTLS only for the Kafka API, and mTLS and basic authentication for HTTP Proxy and Schema Registry, leave out the `kafka_api.sasl` field.

.Show example request
[%collapsible]
====
[,bash,lines=3+13+22]
----
CLUSTER_PATCH_BODY=`cat << EOF
{
  "kafka_api": {
     "mtls": {
        "enabled": true,
        "ca_certificates_pem": ["<ca-certificate-pem>"],
        "principal_mapping_rules": ["<principal-mapping-rule>"]
     },
     "sasl": {
        "enabled": true
     }
  },
  "schema_registry": {
     "mtls": {
        "enabled": true,
        "ca_certificates_pem": ["<ca-certificate-pem>"]
     },
     "sasl": {
        "enabled": true
     }
  },
  "http_proxy": {
     "mtls": {
        "enabled": true,
        "ca_certificates_pem": ["<ca-certificate-pem>"]
     },
     "sasl": {
        "enabled": true
     }
  }
}
EOF`
curl -v -X PATCH \
-H "Content-Type: application/json" \
-H "Authorization: Bearer $AUTH_TOKEN" \
-d "$CLUSTER_PATCH_BODY" https://api.redpanda.com/v1/clusters/<cluster-id>`
----

Make sure to replace the following variables:

[cols="1,1"]
|===
|Placeholder variable |Description

|`<cluster-id>`
|ID of Redpanda cluster.

|`<ca-certificate-pem>`
|A trusted Kafka client CA certificate in PEM format. The `ca_certificates_pem` field accepts a list of certificates.

|`<principal-mapping-rule>`
a|Configurable rule for mapping the Distinguished Name of Kafka client certificates to Kafka principals.  

For example, the mapping rule `RULE:.\*CN=([^,]+).*/\\$1/` maps the following certificate subject to a principal named `test`:

`Subject: C=US, ST=IL, L=Chicago, O=redpanda, OU=cloud, CN=test, emailAddress=test123@redpanda.com`

See xref:ROOT:manage:security/authentication.adoc#mtls[Configure Authentication] for more details on principal mapping rules. The `principal_mapping_rules` field accepts a list of rules.
|===
====

The Update Cluster endpoint returns a long-running operation. You can check the status of the operation by making a `GET` request to the following endpoint:

[,bash]
----
curl -H "Authorization: Bearer $AUTH_TOKEN" https://api.redpanda.com/v1/operations/<operation-id>
----

When the operation state is `COMPLETED`, you can <<verify-mtls,verify that mTLS is enabled>> for the API endpoints.

==== Update an existing cluster to disable SASL

If you enabled mTLS and SASL on a cluster, you can disable SASL by making a link:/api/doc/cloud-controlplane/operation/operation-clusterservice_updatecluster[`PATCH /v1/clusters/{cluster.id}`] request:

.Show example request
[%collapsible]
====
[,bash]
----
CLUSTER_PATCH_BODY=`cat << EOF
{
  "kafka_api": {
     "sasl": {
        "enabled": false
     }
  }
}
EOF`
curl -v -X PATCH \
-H "Content-Type: application/json" \
-H "Authorization: Bearer $AUTH_TOKEN" \
-d "$CLUSTER_PATCH_BODY" https://api.redpanda.com/v1/clusters/<cluster-id>
----
====

=== Retrieve API endpoints

Retrieve the mTLS and SASL-enabled endpoints by calling the `GET /v1/clusters/\{id}` endpoint, passing the cluster ID as a parameter.

[,bash]
----
curl -X GET "https://api.redpanda.com/v1/clusters/<cluster-id>" \
 -H "accept: application/json"\
 -H "content-type: application/json" \
 -H "authorization: Bearer ${AUTH_TOKEN}"
----

The API endpoints are returned in the response body in the following fields:

[cols="1,1,2"]
|=== 
| API | Field | Example

| Kafka API 
| `kafka_api.all_seed_brokers` 
a| 
* `sasl`: `seed-2f92c489.d040oh0mf339m7q5uu0g.byoc.ign.cloud.redpanda.com:9092`
* `mtls`: `seed-2f92c489.d040oh0mf339m7q5uu0g.byoc.ign.cloud.redpanda.com:9093`

| HTTP Proxy 
| `http_proxy.all_urls` 
a| 
* `sasl`: `\https://pandaproxy-ce24d80a.d040oh0mf339m7q5uu0g.byoc.ign.cloud.redpanda.com:30082`
* `mtls`: `\https://pandaproxy-ce24d80a.d040oh0mf339m7q5uu0g.byoc.ign.cloud.redpanda.com:30083`

| Schema Registry 
| `schema_registry.all_urls`
a| 
* `sasl`: `\https://schema-registry-20b02d09.d040oh0mf339m7q5uu0g.byoc.ign.cloud.redpanda.com:30081`
* `mtls`: `\https://schema-registry-20b02d09.d040oh0mf339m7q5uu0g.byoc.ign.cloud.redpanda.com:30080`
|===

[[verify-mtls]]
=== Verify mTLS for Kafka API

To verify that mTLS is enabled for the Kafka API, run the following `rpk` command without providing a security certificate or private key:

[,bash]
----
rpk cluster info --tls-enabled
----

You should get the following error:

```
unable to request metadata: remote error: tls: certificate required
```

[[consume-produce-mtls]]
When you consume, produce to, or manage topics using xref:ROOT:reference:rpk/rpk-topic/rpk-topic.adoc[`rpk`], you must provide a client certificate and private key. You may use the `--tls-cert` and `--tls-key` options, or xref:ROOT:reference:rpk/rpk-x-options.adoc[environment variables] with `rpk`.

[,bash]
----
rpk topic create test-topic --tls-enabled --tls-cert=/path/to/tls.crt --tls-key=/path/to/tls.key
----

[[verify-mtls-http]]
=== Verify mTLS for HTTP Proxy and Schema Registry

To verify that mTLS is enabled for the HTTP Proxy and Schema Registry, run the following `curl` commands, without providing a security certificate or key:

[,bash]
----
# Run the following to verify HTTP Proxy
curl -u $USERNAME:$PASSWORD -k -H "Content-Type: application/vnd.kafka.json.v2+json" --sslv2 --http2 -d '{"records":[{"test":"hello"},{"test":"world"}]}' $HTTP_PROXY_MTLS_URL/topics/<topic-name>

# Run the following to verify Schema Registry
curl -u $USERNAME:$PASSWORD -k -H "Content-Type: application/vnd.schemaregistry.v1+json" $SCHEMA_REGISTRY_MTLS_URL/subjects/<subject-name>/versions/1
----

You should get an error indicating that the certificate is required.

To successfully connect to the HTTP Proxy and Schema Registry, you must provide a client certificate and private key. The following `curl` commands show example requests to mTLS-enabled endpoints using `test` as the username and `12345` as the password.

[,bash]
----
# HTTP Proxy
curl -u test:12345 -k --cert cert.pem --key key.pem -H "Content-Type: application/vnd.kafka.json.v2+json" --sslv2 --http2 https://pandaproxy-45f811b1.cge5asc6006u7fvep0q0.fmc.dev.cloud.redpanda.com:30082/topics

# Schema Registry
curl -u test:12345 -k --cert cert.pem --key key.pem https://schema-registry-15d24f32.cge5asc6006u7fvep0q0.fmc.dev.cloud.redpanda.com:30081/subjects/Kafka-value/versions/1
----

=== Verify SASL

To verify that SASL is enabled for the Kafka API, run:

[,bash]
----
rpk topic create test-topic --tls-enabled --user <username> --password <password>
----

The command should succeed, and you should be able to create a topic named `test-topic`.

include::shared:partial$suggested-reading.adoc[]

- link:/api/doc/cloud-controlplane/topic/topic-cloud-api-overview[Cloud API Overview]
- link:/api/doc/cloud-controlplane/authentication[Cloud API Authentication]
