= Monitor MCP Server Activity
:description: Consume traces, track tool invocations, measure performance, and debug failures in MCP servers.
:page-topic-type: how-to
:personas: platform_admin, ai_agent_developer, data_engineer
:learning-objective-1: Consume traces from the redpanda.otel_traces topic
:learning-objective-2: Track tool invocations and measure performance
:learning-objective-3: Debug tool failures using trace data

Monitor MCP server activity using OpenTelemetry traces emitted to the `redpanda.otel_traces` topic.

After reading this page, you will be able to:

* [ ] {learning-objective-1}
* [ ] {learning-objective-2}
* [ ] {learning-objective-3}

For conceptual background on traces, spans, and the trace data structure, see xref:ai-agents:observability/concepts.adoc[].

== Prerequisites

You must have an existing MCP server. If you do not have one, see xref:ai-agents:mcp/remote/quickstart.adoc[].

== Consume traces

MCP servers emit OpenTelemetry traces to the `redpanda.otel_traces` topic. You can consume these traces using any Kafka-compatible client or the Redpanda Cloud Console.

[tabs]
=====
Cloud Console::
+
--
. In the Redpanda Cloud Console, navigate to *Topics*.
. Select `redpanda.otel_traces`.
. Click *Messages* to view recent traces.
. Use filters to search for specific trace IDs, span names, or time ranges.
--

rpk::
+
--
Consume the most recent traces:

[,bash]
----
rpk topic consume redpanda.otel_traces --offset end -n 10
----

Filter for specific MCP server activity by examining the span attributes.
--

Data Plane API::
+
--
Use the link:/api/doc/cloud-dataplane/[Data Plane API] to programmatically consume traces and integrate with your monitoring pipeline.
--
=====

== Track tool invocations

Monitor which tools are being called and how often:

. Consume traces from `redpanda.otel_traces`.
. Filter spans where `instrumentationScope.name` is `rpcn-mcp`.
. Examine the `name` field to see which tools are being invoked.
. Calculate frequency by counting spans per tool name over time windows.

Example: To find all invocations of a specific tool, filter for spans where `name` matches your tool name (for example, `weather`, `http_processor`).

== Measure performance

Analyze tool execution times:

. Find spans with `instrumentationScope.name` set to `rpcn-mcp`.
. Calculate duration: `(endTimeUnixNano - startTimeUnixNano) / 1000000` (milliseconds).
. Track percentiles (p50, p95, p99) to identify performance issues.
. Set alerts for durations exceeding acceptable thresholds.

Example: A span with `startTimeUnixNano: "1765198415253280028"` and `endTimeUnixNano: "1765198424660663434"` has a duration of 9407ms.

== Debug failures

Investigate errors and failures:

. Filter spans where `status.code` is `2` (error).
. Examine `status.message` for error details.
. Check the `events` array for error events with timestamps.
. Use `traceId` to correlate related spans and understand the full error context.
. Follow `parentSpanId` relationships to trace the error back to the originating tool.

Example: A span with `status.code: 2` and `status.message: "connection timeout"` indicates the operation failed due to a timeout.

== Correlate distributed operations

Link MCP server activity to downstream effects:

. Extract `traceId` from tool invocation spans.
. Search for the same `traceId` in other application logs or traces.
. Follow `parentSpanId` relationships to build complete operation timelines.
. Identify bottlenecks across your entire system.

== Integrate with observability platforms

The `redpanda.otel_traces` topic stores trace data in OpenTelemetry format. Redpanda does not support direct export to platforms like Grafana Cloud and Datadog due to format compatibility limitations. Redpanda produces one span per topic message, whereas these platforms expect traces in batch format.

You can consume traces directly from the `redpanda.otel_traces` topic using any Kafka-compatible consumer for custom analysis and processing.

== Next steps

* xref:ai-agents:observability/concepts.adoc[]: Learn how traces and spans work
* xref:ai-agents:mcp/remote/troubleshooting.adoc[]: Diagnose and fix common issues
* xref:ai-agents:mcp/remote/manage-servers.adoc[]: Manage MCP server lifecycle
