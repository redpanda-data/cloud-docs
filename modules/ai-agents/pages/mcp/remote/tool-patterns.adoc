= MCP Tool Patterns
:page-aliases: ai-agents:mcp/remote/pipeline-patterns.adoc
:description: Catalog of patterns for MCP server tools in Redpanda Cloud.
:page-topic-type: cookbook
:personas: ai_agent_developer, data_engineer
// Reader journey: "I need an example for X"
:learning-objective-1: Find reusable patterns for common MCP tool scenarios
:learning-objective-2: Apply validation and error handling patterns for production robustness
:learning-objective-3: Format responses consistently for AI client consumption

When building tools, use these patterns as starting points for common scenarios. For step-by-step instructions, see xref:ai-agents:mcp/remote/create-tool.adoc[]. For design guidelines, see xref:ai-agents:mcp/remote/best-practices.adoc[].

After reading this page, you will be able to:

* [ ] {learning-objective-1}
* [ ] {learning-objective-2}
* [ ] {learning-objective-3}



[[read-data]]
== Read data

Use xref:develop:connect/components/inputs/about.adoc[inputs] to create tools that read from data sources or generate sample data.

[[data-generators]]
=== Generate test data

*When to use:* Development and testing environments where you need synthetic data, load testing scenarios, or demonstrating data flows without real data sources.

*Example use cases:* Mock user events, test order data, synthetic sensor readings, demo data for presentations.

[source,yaml]
----
include::ai-agents:example$generate_input.yaml[]
----

See also: xref:develop:connect/components/inputs/generate.adoc[`generate` input component]

[[consume-from-redpanda]]
=== Consume from Redpanda topics

*When to use:* Processing events from Redpanda topics, building event-driven AI agents, consuming audit logs, or subscribing to data change streams.

*Example use cases:* Monitor order events, process user activity streams, consume IoT sensor data, react to system notifications.

[source,yaml]
----
redpanda:
  seed_brokers: [ "${REDPANDA_BROKERS}" ]
  topics: [ "user-events" ]
  consumer_group: "mcp-event-processor"
  start_from_oldest: true
  tls:
    enabled: true
  sasl:
    - mechanism: "${REDPANDA_SASL_MECHANISM}"
      username: "${REDPANDA_SASL_USERNAME}"
      password: "${REDPANDA_SASL_PASSWORD}"
----

See also: xref:develop:connect/components/inputs/redpanda.adoc[`redpanda` input]

[[stream-processing]]
=== Process streaming data

*When to use:* Real-time analytics, windowed aggregations, computing metrics over time, or building streaming dashboards.

*Example use cases:* Calculate rolling averages, count events per time window, detect anomalies in streams, aggregate metrics.

[source,yaml]
----
redpanda:
  seed_brokers: [ "${REDPANDA_BROKERS}" ]
  topics: [ "sensor-readings" ]
  consumer_group: "analytics-processor"
  tls:
    enabled: true
  sasl:
    - mechanism: "${REDPANDA_SASL_MECHANISM}"
      username: "${REDPANDA_SASL_USERNAME}"
      password: "${REDPANDA_SASL_PASSWORD}"
  processors:
    - mapping: |
        root.sensor_id = this.sensor_id
        root.avg_temperature = this.readings.map_each(r -> r.temperature).mean()
        root.max_temperature = this.readings.map_each(r -> r.temperature).max()
        root.reading_count = this.readings.length()
        root.window_end = now()
----

See also: xref:develop:connect/components/inputs/redpanda.adoc[`redpanda` input]

[[call-external-services]]
== Call external services

Use xref:develop:connect/components/processors/about.adoc[processors] to fetch data from external APIs, databases, or AI services.

[[external-api-calls]]
=== Call REST APIs

*When to use:* Integrating with third-party services, fetching real-time data, calling internal microservices, or enriching event data with external information.

*Example use cases:* Fetch user profile from CRM, get product pricing from inventory API, validate addresses with geocoding service, retrieve weather data.

[source,yaml]
----
include::ai-agents:example$http_processor.yaml[]
----

See also: xref:develop:connect/components/processors/http.adoc[`http` processor], xref:develop:connect/components/processors/mutation.adoc[`mutation` processor]

[[database-queries]]
=== Query databases

*When to use:* Retrieving customer records, querying analytics data, looking up configuration values, or joining streaming data with dimensional data from data warehouses.

*Example use cases:* Fetch customer details from PostgreSQL, query sales data from BigQuery, retrieve product catalog from MongoDB, look up reference data.

[source,yaml]
----
include::ai-agents:example$gcp_bigquery_select_processor.yaml[]
----

See also: xref:develop:connect/components/processors/gcp_bigquery_select.adoc[`gcp_bigquery_select` processor], xref:develop:connect/components/processors/sql_select.adoc[`sql_select` processor]

[[jira-queries]]
=== Query Jira issues

*When to use:* Fetching tickets by status, checking assignments, finding recent issues, or building AI agents that interact with project management data.

*Example use cases:* Get open bugs for a sprint, find issues assigned to a user, list recently updated tickets, search by custom fields.

[source,yaml]
----
label: search-jira

processors:
  - generate:
      count: 1
      mapping: |
        root.jql = this.jql
        root.maxResults = this.max_results.or(50)
        root.fields = ["key", "summary", "status", "assignee", "priority"]
  - jira:
      base_url: "${secrets.JIRA_BASE_URL}"
      username: "${secrets.JIRA_USERNAME}"
      api_token: "${secrets.JIRA_API_TOKEN}"

meta:
  mcp:
    enabled: true
    description: "Search Jira issues using JQL. Returns matching issues with key, summary, status, assignee, and priority."
    properties:
      - name: jql
        type: string
        description: "JQL query (e.g., 'project = DOC AND status = Open')"
        required: true
      - name: max_results
        type: number
        description: "Maximum issues to return (default: 50)"
        required: false
----

See xref:develop:connect/cookbooks/jira.adoc[] for more patterns including pagination, custom fields, and creating issues via the HTTP processor.

[[ai-llm-integration]]
=== Integrate with AI/LLM services

*When to use:* Generating embeddings for semantic search, calling LLM APIs for text generation, building RAG pipelines, or analyzing sentiment.

*Example use cases:* Generate embeddings for documents, classify customer feedback, summarize long text, extract entities, answer questions with context.

==== OpenAI chat completion

[source,yaml]
----
openai_chat_completion:
  api_key: "${secrets.OPENAI_API_KEY}"
  model: "gpt-4"
  prompt: |
    Analyze this customer feedback and provide:
    1. Sentiment (positive/negative/neutral)
    2. Key themes
    3. Actionable insights

    Feedback: ${! json("feedback_text") }
  max_tokens: 500
----

See also: xref:develop:connect/components/processors/openai_chat_completion.adoc[`openai_chat_completion`], xref:develop:connect/components/processors/openai_embeddings.adoc[`openai_embeddings`]

==== Generate embeddings

[source,yaml]
----
openai_embeddings:
  api_key: "${secrets.OPENAI_API_KEY}"
  model: "text-embedding-3-small"
  text: ${! json("content") }
----

See also: xref:develop:connect/components/processors/cohere_embeddings.adoc[`cohere_embeddings`], xref:develop:connect/components/processors/gcp_vertex_ai_embeddings.adoc[`gcp_vertex_ai_embeddings`]

[[write-data]]
== Write data

Use xref:develop:connect/components/outputs/about.adoc[outputs] to write data to Redpanda topics or cache stores.

[[publish-to-redpanda]]
=== Publish to Redpanda topics

*When to use:* Publishing events to Redpanda for consumption by other services, creating event sourcing patterns, building audit trails, or triggering downstream workflows.

*Example use cases:* Publish order confirmations, emit audit events, trigger notifications, create event-driven workflows.

[source,yaml]
----
include::ai-agents:example$redpanda_output.yaml[]
----

See also: xref:develop:connect/components/outputs/redpanda.adoc[`redpanda` output]

==== Outputs with processors

Output tools can include processors to transform data before publishing. This pattern is useful when you need to process data and save the result to a destination in a single tool.

*When to use:* Processing user input with an LLM and saving the response, transforming data before publishing to a topic, enriching events before writing to external systems.

[source,yaml]
----
include::ai-agents:example$redpanda_output_with_processors.yaml[]
----

[[caching]]
=== Cache data

*When to use:* Reducing repeated API calls, storing lookup tables, caching database query results, or maintaining session state across tool invocations.

*Example use cases:* Cache user profiles, store API rate limit counters, maintain configuration values, cache product catalogs.

.Redpanda-backed cache
[source,yaml]
----
include::ai-agents:example$redpanda_cache.yaml[]
----

.In-memory cache
[source,yaml]
----
include::ai-agents:example$memory_cache.yaml[]
----

See also: xref:develop:connect/components/caches/memory.adoc[`memory` cache], xref:develop:connect/components/outputs/redpanda.adoc[`redpanda` output]

[[transform-data]]
== Transform data

Use Bloblang and processors to transform, validate, and route data.

[[data-transformation]]
=== Transform and validate

*When to use:* Converting data formats, validating schemas, filtering events, enriching messages with computed fields, or normalizing data structures.

*Example use cases:* Parse JSON payloads, validate required fields, add timestamps, convert units, mask sensitive data, aggregate nested objects.

[source,yaml]
----
mapping: |
  # Parse and validate incoming data
  root.user_id = this.user_id.or(throw("user_id is required"))
  root.timestamp = now().ts_format("2006-01-02T15:04:05Z07:00")

  # Transform and enrich
  root.email_domain = this.email.split("@").index(1)
  root.is_premium = this.subscription_tier == "premium"

  # Filter sensitive data
  root.profile = this.profile.without("ssn", "credit_card")
----

See also: xref:develop:connect/components/processors/mapping.adoc[`mapping` processor], xref:develop:connect/guides/bloblang/about.adoc[Bloblang guide]

[[event-driven-workflows]]
=== Build event-driven workflows

*When to use:* Orchestrating multi-step processes, responding to business events, implementing saga patterns, or coordinating microservices.

*Example use cases:* Order fulfillment workflows, approval processes, notification cascades, data pipeline orchestration.

[source,yaml]
----
redpanda:
  seed_brokers: [ "${REDPANDA_BROKERS}" ]
  topics: [ "order-events" ]
  consumer_group: "workflow-orchestrator"
  tls:
    enabled: true
  sasl:
    - mechanism: "${REDPANDA_SASL_MECHANISM}"
      username: "${REDPANDA_SASL_USERNAME}"
      password: "${REDPANDA_SASL_PASSWORD}"
  processors:
    - switch:
        - check: this.event_type == "order_created"
          processors:
            - http:
                url: "${secrets.INVENTORY_API}/reserve"
                verb: POST
                body: '{"order_id": "${! this.order_id }", "items": ${! json("items") }}'
        - check: this.event_type == "payment_confirmed"
          processors:
            - http:
                url: "${secrets.FULFILLMENT_API}/ship"
                verb: POST
                body: '{"order_id": "${! this.order_id }"}'
----

See also: xref:develop:connect/components/inputs/redpanda.adoc[`redpanda` input]

[[production-readiness]]
== Production readiness

Build production-ready tools with proper input validation, error handling, and response formatting.

[[input-validation]]
=== Validate input

AI clients may send unexpected or malformed input. Validate early to return helpful error messages instead of cryptic failures from downstream components.

include::redpanda-connect:ai-agents:partial$mcp/tool-patterns/input-validation.adoc[leveloffset=+1]

[[error-handling]]
=== Handle errors

External services fail. Databases go down. APIs return unexpected responses. Wrap risky operations in error handling so your tool returns useful error messages instead of crashing.

include::redpanda-connect:ai-agents:partial$mcp/tool-patterns/error-handling.adoc[leveloffset=+1]

[[response-formatting]]
=== Format responses

AI clients work best with clean, predictable response structures. Transform raw component output into consistent formats.

include::redpanda-connect:ai-agents:partial$mcp/tool-patterns/response-formatting.adoc[leveloffset=+1]

// Production workflows section - single-sourced from rp-connect-docs
include::redpanda-connect:ai-agents:partial$mcp/tool-patterns/production-workflows.adoc[]

== Next steps

* xref:ai-agents:mcp/remote/create-tool.adoc[]: Step-by-step tool creation guide
* xref:ai-agents:mcp/remote/best-practices.adoc[]: Apply naming and design guidelines
* xref:ai-agents:mcp/remote/troubleshooting.adoc[]: Diagnose and fix common issues
