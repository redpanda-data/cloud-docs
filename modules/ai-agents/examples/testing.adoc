= Test MCP Examples
:description: Automated testing strategies for Redpanda Cloud MCP server examples.

This document describes the automated testing strategies for Redpanda Cloud MCP server examples.

All MCP examples are automatically tested to ensure:

. YAML syntax and structure are correct
. MCP metadata is complete and valid
. Component schemas match Redpanda Connect specifications
. Secrets syntax uses Cloud Secrets Store format (`${secrets.X}`)

== Testing approaches

=== Configuration linting

Validate MCP tool configurations using `rpk connect lint`:

[,bash]
----
# Lint a single MCP tool
rpk connect lint weather_service.yaml

# Lint all examples
rpk connect lint *.yaml

# Lint with environment variable checking skipped (recommended for MCP)
rpk connect lint --skip-env-var-check *.yaml
----

This checks for common issues such as:

* YAML syntax errors
* Unknown component types
* Invalid field names
* Type mismatches
* Missing required fields

=== MCP metadata validation

The test script validates MCP-specific metadata for all tool examples:

[,bash]
----
# Run all tests (includes linting + MCP validation)
./test-mcp-examples.sh

# Test specific files
./test-mcp-examples.sh weather_*.yaml
----

MCP metadata validation checks:

* Presence of `meta.mcp` section
* `enabled: true` is set
* `description` field exists and is non-empty
* `properties` are properly structured (if present)

=== Unit testing limitations

MCP tool examples are standalone component definitions (`label:`, `processors:`, `meta:`), not full pipelines with `input:`, `pipeline:`, `output:` sections. This means they cannot use inline `tests:` sections like cookbook examples do.

The `rpk connect test` command requires full pipeline structure with paths like `/pipeline/processors/0`, which don't exist in MCP tool definitions.

For testing MCP tools:

- Ensure syntax and schema correctness.
- Verify MCP metadata has proper description and properties.
- Perform manual testing using the Cloud UI MCP Server interface to test tools end-to-end.

== MCP tool structure

MCP tools are structured as standalone components:

[,yaml]
----
label: weather-service
processors:
  - label: fetch_weather_data
    http:
      url: 'https://wttr.in/${! @city }?format=j1'
      verb: GET

  - label: format_response
    mutation: |
      root = {
        "city": @city,
        "temperature": this.current_condition.0.temp_C.number()
      }

meta:
  mcp:
    enabled: true
    description: "Get current weather conditions for any city worldwide"
    properties:
      - name: city
        type: string
        description: "Name of the city"
        required: true
----

== Test script usage

The `test-mcp-examples.sh` script provides automated validation:

[,bash]
----
# Test all examples
./test-mcp-examples.sh

# Test specific files
./test-mcp-examples.sh weather_*.yaml
./test-mcp-examples.sh customer_*.yaml
----

The script provides color-coded output:

[,console]
----
ðŸ§ª Redpanda Connect MCP Examples Test Suite (Cloud)
====================================================

ðŸ“„ Testing: weather_service.yaml
  Linting weather_service.yaml... PASSED
  Validating MCP metadata... PASSED

====================================================
ðŸ“Š Test Summary
====================================================
Total configs tested: 10
Passed: 10
Failed: 0

âœ… All tests passed!
----

== Manual end-to-end testing

For comprehensive validation, test MCP tools using the Cloud UI:

. Navigate to your Cloud cluster's MCP Server configuration
. Add or update your MCP tool configuration
. Use the Cloud UI's MCP Inspector to locate your tool
. Verify the tool executes correctly and returns expected results

This validates:

* Tool loads correctly in the MCP server
* Tool executes with provided parameters
* Responses are formatted correctly
* Secrets are properly resolved from Cloud Secrets Store

== GitHub Actions CI/CD

Automated tests run on every push and pull request using GitHub Actions.

The workflow tests all examples whenever:

* Any `.yaml` file in `modules/ai-agents/examples/mcp-tools/` changes
* The test script itself is modified

See `.github/workflows/test-mcp-examples.yaml` for the complete workflow.

== Best practices

=== Use descriptive tool names

[,yaml]
----
# Good
label: fetch-customer-orders

# Bad
label: tool1
----

=== Write clear MCP descriptions

[,yaml]
----
# Good
meta:
  mcp:
    description: "Fetch a customer's order history and calculate spending metrics over the last 30 days"

# Bad
meta:
  mcp:
    description: "Get orders"
----

=== Document all properties

[,yaml]
----
# Good
properties:
  - name: customer_id
    type: string
    description: "Unique identifier for the customer"
    required: true
  - name: days
    type: number
    description: "Number of days to look back (default: 30)"
    required: false

# Bad
properties:
  - name: id
    type: string
    required: true
----

=== Use Cloud Secrets Store for sensitive data

[,yaml]
----
# Cloud format - uses Secrets Store
sql_select:
  driver: "postgres"
  dsn: "${secrets.POSTGRES_DSN}"
  table: "customers"
----

=== Tag your examples

[,yaml]
----
meta:
  tags: [ example, weather, api ]  # Helps organize and filter
  mcp:
    enabled: true
----

== Adding new examples

When adding new MCP tool examples:

. **Create your YAML file** in `modules/ai-agents/examples/mcp-tools/`:
+
[,bash]
----
cd modules/ai-agents/examples
touch my-new-tool.yaml
----

. **Include complete MCP metadata:**
+
[,yaml]
----
label: my-new-tool
processors:
  # Your processor configuration

meta:
  mcp:
    enabled: true
    description: "Clear, task-oriented description"
    properties:
      - name: param_name
        type: string
        description: "Parameter purpose and constraints"
        required: true
----

. **Lint your example:**
+
[,bash]
----
rpk connect lint --skip-env-var-check my-new-tool.yaml
----

. **Run automated tests:**
+
[,bash]
----
./test-mcp-examples.sh my-new-tool.yaml
----

. **Test in Cloud UI (recommended):**
+
Deploy your MCP server configuration and test the tool through the Cloud UI AI interface.

. **Commit your example:**
+
[,bash]
----
git add modules/ai-agents/examples/mcp-tools/my-new-tool.yaml
git commit -m "Add my-new-tool MCP example"
----
